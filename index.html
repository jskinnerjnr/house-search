<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wrong Move by Slim Charles & Co</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f4f0; color: #2c2c2c; -webkit-tap-highlight-color: transparent; }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header { background: #2c2c2c; color: white; display: flex; flex-direction: column; position: sticky; top: 0; z-index: 50; }
  .header-img-wrap { position: relative; }
  .header-img { width: 100%; height: 120px; object-fit: cover; object-position: center 55%; display: block; }
  .header-img-title { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: flex-end; padding: 12px 16px; background: linear-gradient(transparent 30%, rgba(0,0,0,0.6) 100%); }
  .header-img-title h1 { font-size: 1.4rem; font-weight: 800; color: white; text-shadow: 0 1px 4px rgba(0,0,0,0.5); letter-spacing: -0.01em; }
  .header-bar { padding: 8px 16px; display: flex; justify-content: space-between; align-items: center; gap: 8px; }
  header h1 { font-size: 1.1rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .header-right { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
  #last-updated { font-size: 0.78rem; opacity: 0.6; }
  #remote-updated { font-size: 0.7rem; opacity: 0.45; }
  .filter-toggle-btn { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.82rem; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 6px; }
  .filter-toggle-btn.active { background: white; color: #2c2c2c; }

  /* ‚îÄ‚îÄ FILTER DRAWER (mobile: slide-up sheet; desktop: horizontal bar) ‚îÄ‚îÄ */
  .filters-backdrop { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 60; }
  .filters-backdrop.open { display: block; }
  .filters {
    background: white;
    border-bottom: 1px solid #e0e0e0;
    display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end;
    padding: 16px;
  }
  .filter-group { display: flex; flex-direction: column; gap: 4px; }
  .filter-group label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: #888; font-weight: 600; }
  .filter-group select, .filter-group input[type=number] { padding: 8px 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.9rem; background: white; min-width: 130px; }
  .filter-group input[type=range] { min-width: 150px; accent-color: #2c2c2c; }
  .price-display { font-size: 0.78rem; color: #555; margin-top: 2px; font-weight: 500; }
  .reset-btn { padding: 9px 18px; background: #2c2c2c; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 600; }
  .filters-close-btn { display: none; width: 100%; padding: 12px; background: #2c2c2c; color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-top: 4px; }

  /* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
  .stats-bar { padding: 8px 16px; background: #f5f4f0; font-size: 0.8rem; color: #666; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; }

  /* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 12px; padding: 12px; padding-bottom: 80px; }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 1px 4px rgba(0,0,0,0.08); transition: box-shadow 0.2s; cursor: pointer; }
  .card:active { transform: scale(0.99); }
  .card-img-wrap { position: relative; }
  .card-img { width: 100%; height: 200px; object-fit: cover; display: block; background: #f0f0f0; cursor: zoom-in; }
  .card-img-overlay { display: none; position: absolute; bottom: 0; left: 0; right: 0; padding: 28px 14px 10px; background: linear-gradient(transparent, rgba(0,0,0,0.72)); color: white; pointer-events: none; }
  .card-img-overlay .ov-address { font-weight: 700; font-size: 0.95rem; line-height: 1.3; }
  .card-img-overlay .ov-price { font-size: 1rem; font-weight: 700; margin-top: 2px; }
  .card-img-overlay .ov-price .price-reduced, .card-img-overlay .ov-price .new-listing { font-size: 0.65rem; }
  .card-img-placeholder { width: 100%; height: 160px; background: linear-gradient(135deg,#f0f0f0,#e0e0e0); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; font-size: 2rem; color: #aaa; }
  .card-img-placeholder span { font-size: 0.78rem; color: #888; text-decoration: underline; }
  .card-img-link { display: block; text-decoration: none; }
  .card-header { padding: 12px 14px 8px; border-bottom: 1px solid #f0f0f0; }
  .card-address { font-weight: 700; font-size: 0.95rem; }
  .card-location { font-size: 0.78rem; color: #777; margin-top: 2px; }
  .card-price { font-size: 1.15rem; font-weight: 700; color: #2c2c2c; margin-top: 6px; line-height: 1.4; }
  .price-reduced { font-size: 0.68rem; background: #ff6b35; color: white; padding: 2px 6px; border-radius: 4px; margin-left: 6px; vertical-align: middle; }
  .new-listing { font-size: 0.68rem; background: #1a7340; color: white; padding: 2px 6px; border-radius: 4px; margin-left: 6px; vertical-align: middle; font-weight: 700; }
  .card-body { padding: 10px 14px; display: flex; flex-direction: column; gap: 7px; }
  .specs { display: flex; gap: 10px; flex-wrap: wrap; }
  .spec { font-size: 0.8rem; color: #555; display: flex; align-items: center; gap: 3px; }
  .spec strong { color: #2c2c2c; }
  .tags { display: flex; gap: 5px; flex-wrap: wrap; }
  .tag { font-size: 0.7rem; padding: 2px 8px; border-radius: 12px; font-weight: 500; }
  .tag-yes { background: #e6f4ea; color: #2d7a3a; }
  .tag-neutral { background: #eee; color: #555; }
  .school-info { font-size: 0.76rem; color: #555; line-height: 1.5; }
  .school-info a { color: #888; }
  .ofsted-outstanding { color: #1a7340; font-weight: 600; }
  .ofsted-good { color: #2e7bb5; font-weight: 600; }
  .ofsted-ri { color: #c87000; font-weight: 600; }
  .card-footer { padding: 8px 14px; border-top: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 6px; }
  .status-badge { font-size: 0.68rem; padding: 3px 10px; border-radius: 12px; font-weight: 600; }
  .status-new { background: #e3f2fd; color: #1565c0; }
  .status-viewing { background: #fff8e1; color: #b8860b; }
  .status-viewed { background: #f3e5f5; color: #7b1fa2; }
  .status-interested { background: #e8f5e9; color: #2e7d32; }
  .status-offer { background: #fce4ec; color: #c62828; }
  .status-rejected { background: #eeeeee; color: #757575; }
  .rating { color: #f5a623; font-size: 0.9rem; }
  .links { display: flex; gap: 5px; flex-wrap: wrap; }
  .links a { font-size: 0.7rem; color: #2c2c2c; text-decoration: none; padding: 4px 10px; border: 1px solid #ddd; border-radius: 6px; }
  .links a.plan-btn { background: #2c2c2c; color: white; border-color: #2c2c2c; }
  .pros-cons { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 0 14px 10px; }
  .pros h4, .cons h4 { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px; }
  .pros h4 { color: #2d7a3a; }
  .cons h4 { color: #a33; }
  .pros ul, .cons ul { font-size: 0.76rem; color: #555; padding-left: 14px; }
  .notes-section { padding: 0 14px 10px; font-size: 0.76rem; color: #666; font-style: italic; }
  .empty-state { grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #aaa; }

  /* ‚îÄ‚îÄ FAB (add button) ‚îÄ‚îÄ */
  .add-btn { position: fixed; bottom: 20px; right: 16px; background: #2c2c2c; color: white; border: none; border-radius: 50%; width: 54px; height: 54px; font-size: 1.6rem; cursor: pointer; box-shadow: 0 4px 14px rgba(0,0,0,0.35); display: flex; align-items: center; justify-content: center; z-index: 40; }

  /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
  .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: flex-start; padding: 16px; overflow-y: auto; }
  .modal-overlay.open { display: flex; }
  .modal { background: white; border-radius: 16px; padding: 20px; width: 100%; max-width: 620px; margin: auto; }
  .modal h2 { margin-bottom: 16px; font-size: 1.1rem; }
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .form-group { display: flex; flex-direction: column; gap: 4px; }
  .form-group.full { grid-column: 1 / -1; }
  .form-group label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: #888; font-weight: 600; }
  .form-group input, .form-group select, .form-group textarea { padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; font-family: inherit; }
  .form-group textarea { resize: vertical; min-height: 60px; }
  .modal-close-x { position: absolute; top: 14px; right: 14px; background: #f0f0f0; border: none; border-radius: 50%; width: 34px; height: 34px; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #555; line-height: 1; }
  .modal-close-x:hover { background: #e0e0e0; }
  .modal { position: relative; }
  .modal-actions { display: flex; gap: 10px; margin-top: 16px; justify-content: flex-end; }
  .btn-save { padding: 10px 22px; background: #2c2c2c; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; }
  .btn-cancel { padding: 10px 22px; background: #eee; color: #333; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; }
  .btn-delete { padding: 10px 22px; background: #c0392b; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; margin-right: auto; }
  .section-divider { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; color: #aaa; font-weight: 600; grid-column: 1 / -1; margin-top: 4px; border-top: 1px solid #eee; padding-top: 8px; }

  /* ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ */
  .lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 300; flex-direction: column; align-items: center; justify-content: center; }
  .lightbox.open { display: flex; }
  .lb-close { position: fixed; top: 14px; right: 16px; background: rgba(255,255,255,0.15); border: none; color: white; font-size: 1.4rem; cursor: pointer; z-index: 301; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
  .lb-prev, .lb-next { position: fixed; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.15); border: none; color: white; font-size: 2rem; cursor: pointer; padding: 10px 14px; border-radius: 8px; z-index: 301; }
  .lb-prev { left: 8px; }
  .lb-next { right: 8px; }
  .lb-tabs { display: flex; gap: 8px; margin-bottom: 10px; }
  .lb-tab { padding: 6px 16px; background: rgba(255,255,255,0.15); color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 0.82rem; }
  .lb-tab.active { background: white; color: #2c2c2c; font-weight: 600; }
  .lb-img { max-width: 92vw; max-height: 72vh; object-fit: contain; border-radius: 6px; }
  .lb-caption { color: rgba(255,255,255,0.6); font-size: 0.8rem; margin-top: 8px; }
  .lb-thumbs { display: flex; gap: 6px; margin-top: 10px; flex-wrap: wrap; justify-content: center; max-width: 92vw; }
  .lb-thumb { width: 54px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer; opacity: 0.5; border: 2px solid transparent; }
  .lb-thumb.active { opacity: 1; border-color: white; }

  /* ‚îÄ‚îÄ MOBILE OVERRIDES ‚îÄ‚îÄ */
  @media (max-width: 640px) {
    /* Header */
    .header-img { height: 110px; }
    .header-img-title h1 { font-size: 1.2rem; }
    .header-bar { padding: 6px 12px; }
    #last-updated { display: none; }
    #remote-updated { display: none; }
    .filter-toggle-btn { display: flex; font-size: 0.8rem; padding: 7px 14px; }

    /* Filter drawer - bottom sheet */
    .filters {
      display: none;
      position: fixed; bottom: 0; left: 0; right: 0;
      max-height: 88vh; overflow-y: auto;
      border-radius: 22px 22px 0 0;
      border-bottom: none;
      box-shadow: 0 -6px 30px rgba(0,0,0,0.22);
      z-index: 70;
      flex-direction: column;
      padding: 8px 16px 24px;
      gap: 0;
    }
    .filters.open { display: flex; }
    .filters::before { content: ''; display: block; width: 36px; height: 4px; background: #ddd; border-radius: 4px; margin: 10px auto 16px; flex-shrink: 0; }

    /* 2-column filter grid on mobile */
    .filter-group { width: 100%; }
    .filters-inner-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; }
    .filters-inner-grid .filter-group-wide { grid-column: 1 / -1; }
    .filter-group select, .filter-group input[type=number] { width: 100%; font-size: 0.95rem; padding: 11px 10px; border-radius: 10px; }
    .filter-group input[type=range] { width: 100%; height: 6px; }
    .filter-group label { font-size: 0.68rem; margin-bottom: 2px; }
    .price-display { font-size: 0.82rem; font-weight: 600; color: #2c2c2c; }

    /* Buttons in filter sheet */
    .filter-btns-row { display: flex; gap: 10px; width: 100%; margin-top: 16px; }
    .reset-btn { flex: 1; padding: 13px; font-size: 0.9rem; border-radius: 12px; background: #f0f0f0; color: #2c2c2c; }
    .filters-close-btn { display: flex; flex: 2; align-items: center; justify-content: center; padding: 13px; font-size: 0.95rem; border-radius: 12px; }

    /* Stats */
    .stats-bar { padding: 7px 12px; font-size: 0.8rem; font-weight: 600; }

    /* Cards - minimal mobile view */
    .grid { grid-template-columns: 1fr; gap: 10px; padding: 10px 10px 90px; }
    .card-img { height: 220px; }
    .card-img-overlay { display: block; }
    .card-header { display: none; }
    .card-body .school-info { display: none; }
    .card-body .tags { display: none; }
    .card-body > div[style*="color:#555"] { display: none; } /* other detail */
    .add-btn { bottom: 16px; right: 12px; width: 50px; height: 50px; font-size: 1.4rem; }

    /* Modal slides up from bottom */
    .form-grid { grid-template-columns: 1fr; }
    .modal { padding: 16px; border-radius: 20px 20px 0 0; margin: auto 0 0 0; }
    .modal-overlay { align-items: flex-end; padding: 0; }
  }

  /* ‚îÄ‚îÄ DESKTOP ‚îÄ‚îÄ */
  @media (min-width: 641px) {
    .header-img { height: 200px; }
    header h1 { font-size: 1.3rem; }
    .filter-toggle-btn { display: none; }
    .filters { padding: 14px 20px; }
    .filters-close-btn { display: none !important; }
    .grid { padding: 16px 20px; gap: 16px; }
    .stats-bar { padding: 8px 20px; }
    header { position: relative; }
  }
/* build trigger */
</style>
</head>
<body>

<header>
  <div class="header-img-wrap">
    <img class="header-img" src="banner.jpg" alt="Cotswolds">
    <div class="header-img-title"><h1>Wrong Move by Slim Charles &amp; Co</h1></div>
  </div>
  <div class="header-bar">
    <span style="font-size:0.78rem;opacity:0.7">Cheltenham &amp; surrounds</span>
    <div class="header-right">
      <span id="last-updated">0 properties</span>
      <span id="remote-updated"></span>
      <button class="filter-toggle-btn" id="filter-toggle-btn" onclick="toggleFilters()">‚öôÔ∏è Filters</button>
    </div>
  </div>
</header>

<div class="filters-backdrop" id="filters-backdrop" onclick="toggleFilters()"></div>
<div class="filters" id="filters-panel">
  <div class="filter-group">
    <label>Max Price</label>
    <input type="range" id="f-price" min="200000" max="5000000" step="50000" value="1200000">
    <div class="price-display" id="price-display">Up to ¬£1,200,000</div>
  </div>
  <div class="filter-group">
    <label>Min Beds</label>
    <select id="f-beds">
      <option value="0">Any</option>
      <option value="4" selected>4+</option>
      <option value="5">5+</option>
      <option value="6">6+</option>
    </select>
  </div>
  <div class="filter-group">
    <label>Min Baths</label>
    <select id="f-baths">
      <option value="0" selected>Any</option>
      <option value="2">2+</option>
      <option value="3">3+</option>
    </select>
  </div>
  <div class="filter-group">
    <label>Property Type</label>
    <select id="f-type">
      <option value="">Any</option>
      <option value="Detached">Detached</option>
      <option value="Semi-detached">Semi-detached</option>
      <option value="Terraced">Terraced</option>
      <option value="Cottage">Cottage</option>
      <option value="Farmhouse">Farmhouse</option>
      <option value="Barn">Barn</option>
      <option value="Country House">Country House</option>
      <option value="Manor">Manor</option>
      <option value="Period House">Period House</option>
      <option value="Townhouse">Townhouse</option>
      <option value="Bungalow">Bungalow</option>
    </select>
  </div>
  <div class="filter-group">
    <label>Max Distance from Cheltenham</label>
    <input type="range" id="f-radius" min="1" max="20" step="1" value="8">
    <div class="price-display" id="radius-display">Within 8 miles</div>
  </div>
  <select id="f-garden" style="display:none"></select>
  <select id="f-outbuildings" style="display:none"></select>
  <div class="filter-group">
    <label>Primary School</label>
    <select id="f-school">
      <option value="">Any Ofsted</option>
      <option value="Outstanding">Outstanding</option>
      <option value="Good">Good+</option>
    </select>
  </div>
  <div class="filter-group">
    <label>Secondary School</label>
    <select id="f-sec-school">
      <option value="">Any Ofsted</option>
      <option value="Outstanding">Outstanding</option>
      <option value="Good">Good+</option>
    </select>
  </div>
  <div class="filter-group">
    <label>Status</label>
    <select id="f-status">
      <option value="">All</option>
      <option value="New">New</option>
      <option value="Viewing Booked">Viewing Booked</option>
      <option value="Viewed">Viewed</option>
      <option value="Interested">Interested</option>
      <option value="Offer Made">Offer Made</option>
      <option value="Rejected">Rejected</option>
    </select>
  </div>
  <div class="filter-group">
    <label>Min Rating</label>
    <select id="f-rating">
      <option value="0">Any</option>
      <option value="3">3+ ‚≠ê</option>
      <option value="4">4+ ‚≠ê</option>
      <option value="5">5 ‚≠ê</option>
    </select>
  </div>
  <div class="filter-group">
    <label>Sort By</label>
    <select id="f-sort">
      <option value="default">Default</option>
<option value="price-asc">Price: Low to High</option>
      <option value="price-desc" selected>Price: High to Low</option>
      <option value="beds-desc">Most Beds</option>
      <option value="rating-desc">My Rating</option>
      <option value="school-dist">School Distance</option>
    </select>
  </div>
  <div class="filter-btns-row">
    <button class="reset-btn" onclick="resetFilters()">Reset</button>
    <button class="filters-close-btn" onclick="toggleFilters()">Show Results</button>
  </div>
</div>

<div class="stats-bar" id="stats-bar">Showing 0 properties</div>
<div class="grid" id="grid"></div>
<button class="add-btn" onclick="openModal()" title="Add property">+</button>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <button class="lb-close" onclick="closeLightbox()">‚úï</button>
  <button class="lb-prev" onclick="lbNav(-1)">&#8249;</button>
  <button class="lb-next" onclick="lbNav(1)">&#8250;</button>
  <div class="lb-tabs" id="lb-tabs"></div>
  <img class="lb-img" id="lb-img" src="" alt="">
  <div class="lb-caption" id="lb-caption"></div>
  <div class="lb-thumbs" id="lb-thumbs"></div>
</div>

<!-- Add/Edit Modal -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <button class="modal-close-x" onclick="closeModal()" title="Close">‚úï</button>
    <h2 id="modal-title">Add Property</h2>
    <div class="form-grid">
      <div class="section-divider">üìç Property Details</div>
      <div class="form-group full"><label>Address</label><input type="text" id="f-address" placeholder="123 Example Lane"></div>
      <div class="form-group"><label>Town / Village</label><input type="text" id="f-town" placeholder="Prestbury"></div>
      <div class="form-group"><label>Postcode</label><input type="text" id="f-postcode" placeholder="GL52 3XX"></div>
      <div class="form-group"><label>Asking Price (¬£)</label><input type="number" id="f-asking-price" placeholder="850000"></div>
      <div class="form-group"><label>Price Reduced?</label>
        <select id="f-price-reduced"><option value="No">No</option><option value="Yes">Yes</option></select>
      </div>
      <div class="form-group"><label>Beds</label><input type="number" id="f-beds-count" placeholder="4" min="1"></div>
      <div class="form-group"><label>Baths</label><input type="number" id="f-baths-count" placeholder="2" min="1"></div>
      <div class="form-group"><label>Reception Rooms</label><input type="number" id="f-receptions" placeholder="3" min="0"></div>
      <div class="form-group"><label>Property Type</label>
        <select id="f-prop-type"><option>Detached</option><option>Semi-detached</option><option>Terraced</option><option>Barn</option><option>Cottage</option><option>Farmhouse</option><option>Other</option></select>
      </div>
      <div class="form-group"><label>Tenure</label>
        <select id="f-tenure"><option>Freehold</option><option>Leasehold</option></select>
      </div>
      <div class="form-group"><label>New Build?</label>
        <select id="f-new-build"><option value="No">No</option><option value="Yes">Yes</option></select>
      </div>
      <div class="section-divider">üå≥ Garden & Grounds</div>
      <div class="form-group"><label>Garden</label>
        <select id="f-garden-yn"><option value="Yes">Yes</option><option value="No">No</option></select>
      </div>
      <div class="form-group"><label>Garden Size</label><input type="text" id="f-garden-size" placeholder="Large / 0.5 acres"></div>
      <div class="form-group"><label>Outbuildings</label>
        <select id="f-out-yn"><option value="Yes">Yes</option><option value="No">No</option></select>
      </div>
      <div class="form-group"><label>Outbuilding Details</label><input type="text" id="f-out-detail" placeholder="Barn, Workshop, Store"></div>
      <div class="form-group"><label>Driveway</label>
        <select id="f-drive"><option value="Yes">Yes</option><option value="No">No</option></select>
      </div>
      <div class="form-group"><label>Garage</label>
        <select id="f-garage"><option value="Yes">Yes</option><option value="No">No</option></select>
      </div>
      <div class="form-group full"><label>Other Features</label><input type="text" id="f-other" placeholder="Pool, annexe, tennis court..."></div>
      <div class="section-divider">üó∫Ô∏è Location</div>
      <div class="form-group"><label>Distance to Cheltenham (miles)</label><input type="number" id="f-distance" placeholder="1.8" step="0.1"></div>
      <div class="form-group"><label>Rural / Suburban / Village</label>
        <select id="f-rural"><option>Rural</option><option>Village</option><option>Suburban</option><option>Town</option></select>
      </div>
      <div class="section-divider">üè¢ Listing</div>
      <div class="form-group"><label>Estate Agent</label><input type="text" id="f-agent" placeholder="Hamptons"></div>
      <div class="form-group"><label>Date Listed</label><input type="date" id="f-date-listed"></div>
      <div class="form-group full"><label>Rightmove Link</label><input type="url" id="f-rm-link"></div>
      <div class="form-group full"><label>Zoopla Link</label><input type="url" id="f-zp-link"></div>
      <div class="form-group full"><label>OnTheMarket Link</label><input type="url" id="f-otm-link"></div>
      <div class="section-divider">‚úÖ Your Assessment</div>
      <div class="form-group"><label>Status</label>
        <select id="f-stat"><option>New</option><option>Viewing Booked</option><option>Viewed</option><option>Interested</option><option>Offer Made</option><option>Rejected</option></select>
      </div>
      <div class="form-group"><label>Viewing Date</label><input type="date" id="f-view-date"></div>
      <div class="form-group"><label>Our Rating (1-5)</label>
        <select id="f-our-rating"><option value="">‚Äî</option><option value="1">1 ‚≠ê</option><option value="2">2 ‚≠ê</option><option value="3">3 ‚≠ê</option><option value="4">4 ‚≠ê</option><option value="5">5 ‚≠ê</option></select>
      </div>
      <div class="form-group full"><label>Pros</label><textarea id="f-pros" placeholder="One per line"></textarea></div>
      <div class="form-group full"><label>Cons</label><textarea id="f-cons" placeholder="One per line"></textarea></div>
      <div class="form-group full"><label>Notes</label><textarea id="f-notes"></textarea></div>
    </div>
    <div class="modal-actions">
      <button class="btn-delete" id="btn-delete" onclick="deleteProperty()" style="display:none">Delete</button>
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="btn-save" onclick="saveProperty()">Save</button>
    </div>
  </div>
</div>

<script>
var properties = [];
var editingId = null;
var lbImages = [];
var lbIndex = 0;
var lbMode = 'photos';
var lbCurrentId = null;

function toggleFilters() {
  var panel = document.getElementById('filters-panel');
  var backdrop = document.getElementById('filters-backdrop');
  var btn = document.getElementById('filter-toggle-btn');
  var isOpen = panel.classList.toggle('open');
  backdrop.classList.toggle('open', isOpen);
  if (btn) btn.classList.toggle('active', isOpen);
  document.body.style.overflow = isOpen ? 'hidden' : '';
}

var TODAY_STR = new Date().toISOString().slice(0,10);
var WEEK_AGO  = new Date(Date.now() - 7*24*60*60*1000).toISOString().slice(0,10);
function isNewListing(p) {
  var d = p.lastUpdated || p.dateListed || '';
  return d >= WEEK_AGO && d <= TODAY_STR;
}

function fmt(n) {
  if (!n) return '‚Äî';
  return '¬£' + Number(n).toLocaleString('en-GB');
}
function stars(n) { return n ? '‚≠ê'.repeat(Number(n)) : ''; }
function ofstedClass(o) {
  if (o === 'Outstanding') return 'ofsted-outstanding';
  if (o === 'Good') return 'ofsted-good';
  if (o === 'Requires Improvement') return 'ofsted-ri';
  return '';
}
function statusClass(s) {
  var m = {'New':'new','Viewing Booked':'viewing','Viewed':'viewed','Interested':'interested','Offer Made':'offer','Rejected':'rejected'};
  return 'status-' + (m[s] || 'new');
}

// CATCHMENT SCHOOLS by postcode sector
var CATCHMENT_PRI = {
  'GL525':'Prestbury CE Primary','GL526':'St Philip and St James CE Primary',
  'GL523':'Swindon Village Primary Academy','GL521':'Bishops Cleeve Primary',
  'GL530':'Naunton Park Primary','GL531':'Leckhampton CE Primary',
  'GL538':'Charlton Kings Infant School','GL539':'Charlton Kings Infant School',
  'GL510':'Up Hatherley CE Junior School','GL516':'Hatherley Infant School',
  'GL513':'Swindon Village Primary Academy','GL518':'Benhall Infant School',
  'GL519':'Shurdington CE Primary','GL502':'St Gregorys Catholic Primary',
  'GL504':'All Saints Academy','GL501':'St Edwards CE Primary'
};
var CATCHMENT_SEC = {
  'GL525':'Balcarras School','GL526':'Cleeve School',
  'GL523':'Cheltenham Bournside School','GL521':'Cleeve School',
  'GL530':'Balcarras School','GL531':'Balcarras School',
  'GL538':'Balcarras School','GL539':'Balcarras School',
  'GL510':'Cheltenham Bournside School','GL516':'Cheltenham Bournside School',
  'GL513':'Cheltenham Bournside School','GL518':'Cheltenham Bournside School',
  'GL519':'Cheltenham Bournside School','GL502':'Cheltenham Bournside School',
  'GL504':'Cheltenham Bournside School','GL501':'Cheltenham Bournside School'
};
var OFSTED_PRI = {
  'Naunton Park Primary':'Outstanding',
  'Prestbury CE Primary':'Good','St Philip and St James CE Primary':'Good',
  'Swindon Village Primary Academy':'Good','Bishops Cleeve Primary':'Good',
  'Leckhampton CE Primary':'Good','Charlton Kings Infant School':'Good',
  'Up Hatherley CE Junior School':'Good','Hatherley Infant School':'Good',
  'Benhall Infant School':'Good','Shurdington CE Primary':'Good',
  'St Gregorys Catholic Primary':'Good','All Saints Academy':'Good',
  'St Edwards CE Primary':'Good'
};
var OFSTED_SEC = {
  'Balcarras School':'Outstanding','Cheltenham Bournside School':'Outstanding',
  'Cleeve School':'Good'
};

function getCatchmentHTML(postcode) {
  if (!postcode || postcode.length < 5) return '';
  var pc = postcode.toUpperCase().replace(/\s/g,'');
  if (pc.length < 5) return '';
  var sector = pc.slice(0,5);
  var pri = CATCHMENT_PRI[sector] || null;
  var sec = CATCHMENT_SEC[sector] || null;
  var html = '';
  if (pri) {
    var o = OFSTED_PRI[pri] || '';
    html += '<div class="school-info">üè´ <strong>Primary:</strong> ' + pri + (o ? ' ‚Äî <span class="' + ofstedClass(o) + '">' + o + '</span>' : '') + '</div>';
  }
  if (sec) {
    var os = OFSTED_SEC[sec] || '';
    html += '<div class="school-info">üéì <strong>Secondary:</strong> ' + sec + (os ? ' ‚Äî <span class="' + ofstedClass(os) + '">' + os + '</span>' : '') + '</div>';
  }
  if (!pri && !sec) {
    html = '<div class="school-info"><a href="https://www.gloucestershire.gov.uk/education-and-learning/schools-and-admissions/school-admissions/find-your-catchment-area-school/?postcode=' + encodeURIComponent(postcode) + '" target="_blank" onclick="event.stopPropagation()">Check catchment ‚Üó</a></div>';
  }
  return html;
}

function getFilters() {
  return {
    price: parseInt(document.getElementById('f-price').value),
    beds: parseInt(document.getElementById('f-beds').value),
    baths: parseInt(document.getElementById('f-baths').value),
    type: document.getElementById('f-type').value,
    radius: parseFloat(document.getElementById('f-radius').value),
    garden: document.getElementById('f-garden').value || '',
    outbuildings: document.getElementById('f-outbuildings').value || '',
    school: document.getElementById('f-school').value,
    secSchool: document.getElementById('f-sec-school').value,
    status: document.getElementById('f-status').value,
    rating: parseInt(document.getElementById('f-rating').value) || 0,
    sort: document.getElementById('f-sort').value
  };
}

function matchesFilters(p, f) {
  if (p.askingPrice && p.askingPrice > f.price) return false;
  if (f.beds && (!p.beds || p.beds < f.beds)) return false;
  if (f.baths && p.baths && p.baths < f.baths) return false;
  if (f.type && p.propType !== f.type) return false;
  if (f.radius < 20 && p.distMiles != null && p.distMiles > f.radius) return false;
  if (f.garden === 'Yes' && p.garden === 'No') return false;
  if (f.outbuildings === 'Yes' && p.outbuildings === 'No') return false;
  if (f.status && p.status !== f.status) return false;
  if (f.rating && (!p.rating || p.rating < f.rating)) return false;
  // School filters using catchment data
  if (f.school || f.secSchool) {
    var pc = (p.postcode||'').toUpperCase().replace(/\s/g,'');
    var sector = pc.slice(0,5);
    if (f.school === 'Outstanding') {
      var pri = CATCHMENT_PRI[sector];
      if (!pri || OFSTED_PRI[pri] !== 'Outstanding') return false;
    }
    if (f.school === 'Good') {
      var pri2 = CATCHMENT_PRI[sector];
      if (!pri2 || !['Outstanding','Good'].includes(OFSTED_PRI[pri2])) return false;
    }
    if (f.secSchool === 'Outstanding') {
      var sec = CATCHMENT_SEC[sector];
      if (!sec || OFSTED_SEC[sec] !== 'Outstanding') return false;
    }
    if (f.secSchool === 'Good') {
      var sec2 = CATCHMENT_SEC[sector];
      if (!sec2 || !['Outstanding','Good'].includes(OFSTED_SEC[sec2])) return false;
    }
  }
  return true;
}

function render() {
  var f = getFilters();
  var filtered = properties.filter(function(p) { return matchesFilters(p, f); });
  filtered.sort(function(a, b) {
    if (f.sort === 'price-asc') return (a.askingPrice||0) - (b.askingPrice||0);
    if (f.sort === 'price-desc') return (b.askingPrice||0) - (a.askingPrice||0);
    if (f.sort === 'beds-desc') return (b.beds||0) - (a.beds||0);
    if (f.sort === 'rating-desc') return (b.rating||0) - (a.rating||0);
    if (f.sort === 'school-dist') return (a.priDist||99) - (b.priDist||99);
    return 0;
  });
  var statsEl = document.getElementById('stats-bar');
  statsEl.innerHTML = '<strong>' + filtered.length + '</strong> properties' + (filtered.length < properties.length ? ' <span style="font-weight:400;opacity:0.6">of ' + properties.length + '</span>' : '');
  var btn = document.getElementById('filter-toggle-btn');
  if (btn) btn.innerHTML = '&#9881;&#65039; Filters &nbsp;<span style="background:white;color:#2c2c2c;border-radius:10px;padding:1px 7px;font-size:0.75rem;font-weight:700">' + filtered.length + '</span>';
  document.getElementById('last-updated').textContent = properties.length + ' properties';
  var grid = document.getElementById('grid');
  if (filtered.length === 0) {
    grid.innerHTML = '<div class="empty-state"><p>' + (properties.length === 0 ? 'No properties yet ‚Äî click + to add your first listing' : 'No properties match your filters') + '</p></div>';
    return;
  }
  grid.innerHTML = filtered.map(function(p) {
    var priceHtml = fmt(p.askingPrice)
      + (p.priceReduced === 'Yes' ? '<span class="price-reduced">REDUCED</span>' : '')
      + (isNewListing(p) ? '<span class="new-listing">NEW</span>' : '')
      + (p.lastUpdated ? '<span style="font-size:0.72rem;color:#4a7fc1;margin-left:6px">' + (function(d){var pt=d.split('-');return pt.length===3?pt[2]+'/'+pt[1]+'/'+pt[0]:d;})(p.lastUpdated) + '</span>' : '');
    var hasPhotos = p.photos && p.photos.length > 0;
    var hasFP = p.floorPlans && p.floorPlans.length > 0;
    var rawImg = hasPhotos
      ? '<img class="card-img" src="' + p.photos[0] + '" alt="' + (p.address||'') + '" loading="lazy" referrerpolicy="no-referrer" onerror="this.outerHTML=\'<a href=\\\&quot;' + (p.rmLink||p.otmLink||'#') + '\\\&quot; target=\\\&quot;_blank\\\&quot; onclick=\\\&quot;event.stopPropagation()\\\&quot; class=\\\&quot;card-img-link\\\&quot;><div class=\\\&quot;card-img-placeholder\\\&quot;>üè°<br><span>View photos on Rightmove ‚Üó</span></div></a>\'" onclick="event.stopPropagation();openLightbox(\'' + p.id + '\',0,\'photos\')">'
      : '<div class="card-img-placeholder">üè°</div>';
    var imgHtml = '<div class="card-img-wrap">' + rawImg
      + '<div class="card-img-overlay">'
      + '<div class="ov-address">' + (p.address||'Address TBC') + (p.town ? ', ' + p.town : '') + '</div>'
      + '<div class="ov-price">' + priceHtml + '</div>'
      + '</div></div>';
    var planBtn = hasFP
      ? '<a href="#" class="plan-btn" onclick="event.preventDefault();event.stopPropagation();openLightbox(\'' + p.id + '\',0,\'floorplan\')">üìê Plan</a>'
      : '';
    var school = getCatchmentHTML(p.postcode);
    var tags = '';
    if (p.garden === 'Yes') tags += '<span class="tag tag-yes">Garden ‚úì</span>';
    if (p.outbuildings === 'Yes') tags += '<span class="tag tag-yes">Outbuildings ‚úì</span>';
    if (p.driveway === 'Yes') tags += '<span class="tag tag-yes">Driveway ‚úì</span>';
    if (p.garage === 'Yes') tags += '<span class="tag tag-yes">Garage ‚úì</span>';
    if (p.tenure) tags += '<span class="tag tag-neutral">' + p.tenure + '</span>';
    var specs = '';
    if (p.beds) specs += '<div class="spec">üõè <strong>' + p.beds + '</strong> beds</div>';
    if (p.baths) specs += '<div class="spec">üöø <strong>' + p.baths + '</strong> baths</div>';
    if (p.receptions) specs += '<div class="spec">üõã <strong>' + p.receptions + '</strong> recep</div>';
    if (p.propType) specs += '<div class="spec">üè† ' + p.propType + '</div>';
    if (p.distMiles) specs += '<div class="spec">üìç <strong>' + p.distMiles + 'mi</strong> from Cheltenham</div>';
    var prosCons = '';
    if (p.pros || p.cons) {
      prosCons = '<div class="pros-cons">';
      if (p.pros) prosCons += '<div class="pros"><h4>Pros</h4><ul>' + p.pros.split('\n').filter(Boolean).map(function(l){return '<li>'+l+'</li>';}).join('') + '</ul></div>';
      else prosCons += '<div></div>';
      if (p.cons) prosCons += '<div class="cons"><h4>Cons</h4><ul>' + p.cons.split('\n').filter(Boolean).map(function(l){return '<li>'+l+'</li>';}).join('') + '</ul></div>';
      else prosCons += '<div></div>';
      prosCons += '</div>';
    }
    var notes = p.notes ? '<div class="notes-section">' + p.notes + '</div>' : '';
    var rmLink = p.rmLink ? '<a href="' + p.rmLink + '" target="_blank" onclick="event.stopPropagation()">RM</a>' : '';
    var zpLink = p.zpLink ? '<a href="' + p.zpLink + '" target="_blank" onclick="event.stopPropagation()">ZP</a>' : '';
    var otmLink = p.otmLink ? '<a href="' + p.otmLink + '" target="_blank" onclick="event.stopPropagation()">OTM</a>' : '';
    return '<div class="card" onclick="openModal(\'' + p.id + '\')">'
      + imgHtml
      + '<div class="card-header">'
      + '<div class="card-address">' + (p.address||'Address TBC') + '</div>'
      + '<div class="card-location">' + [p.town, p.postcode].filter(Boolean).join(' ¬∑ ') + '</div>'
      + '<div class="card-price">' + priceHtml + '</div>'
      + '</div>'
      + '<div class="card-body">'
      + '<div class="specs">' + specs + '</div>'
      + (tags ? '<div class="tags">' + tags + '</div>' : '')
      + school
      + (p.other ? '<div class="school-info" style="color:#555">‚ú® ' + p.other + '</div>' : '')
      + '</div>'
      + prosCons + notes
      + '<div class="card-footer">'
      + '<span class="status-badge ' + statusClass(p.status) + '">' + (p.status||'New') + '</span>'
      + '<span class="rating">' + stars(p.rating) + '</span>'
      + '<div class="links">' + rmLink + zpLink + otmLink + planBtn + '</div>'
      + '</div>'
      + '</div>';
  }).join('');
}

// LIGHTBOX
function openLightbox(id, startIndex, mode) {
  var p = properties.find(function(x) { return x.id === id; });
  if (!p) return;
  lbCurrentId = id;
  lbMode = mode || 'photos';
  lbImages = lbMode === 'floorplan' ? (p.floorPlans||[]) : (p.photos||[]);
  if (!lbImages.length) return;
  lbIndex = startIndex || 0;
  var hasFP = p.floorPlans && p.floorPlans.length > 0;
  var tabsHtml = hasFP
    ? '<button class="lb-tab ' + (lbMode==='photos'?'active':'') + '" onclick="switchLbMode(\'photos\')" style="pointer-events:auto">üì∑ Photos (' + (p.photos||[]).length + ')</button>'
      + '<button class="lb-tab ' + (lbMode==='floorplan'?'active':'') + '" onclick="switchLbMode(\'floorplan\')" style="pointer-events:auto">üìê Floor Plan</button>'
    : '<button class="lb-tab active">üì∑ Photos (' + (p.photos||[]).length + ')</button>';
  document.getElementById('lb-tabs').innerHTML = tabsHtml;
  renderLightbox();
  document.getElementById('lightbox').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function switchLbMode(mode) {
  var p = properties.find(function(x) { return x.id === lbCurrentId; });
  if (!p) return;
  lbMode = mode;
  lbImages = mode === 'floorplan' ? (p.floorPlans||[]) : (p.photos||[]);
  lbIndex = 0;
  var tabs = document.querySelectorAll('.lb-tab');
  tabs.forEach(function(t, i) {
    t.classList.toggle('active', (i===0&&mode==='photos')||(i===1&&mode==='floorplan'));
  });
  renderLightbox();
}

function renderLightbox() {
  var lbEl = document.getElementById('lb-img');
  lbEl.referrerPolicy = 'no-referrer';
  lbEl.src = lbImages[lbIndex] || '';
  document.getElementById('lb-caption').textContent = (lbIndex+1) + ' / ' + lbImages.length;
  document.getElementById('lb-thumbs').innerHTML = lbImages.map(function(img, i) {
    return '<img class="lb-thumb ' + (i===lbIndex?'active':'') + '" src="' + img + '" referrerpolicy="no-referrer" onclick="lbIndex=' + i + ';renderLightbox()" loading="lazy">';
  }).join('');
}

function lbNav(dir) {
  lbIndex = (lbIndex + dir + lbImages.length) % lbImages.length;
  renderLightbox();
}

function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
  document.body.style.overflow = '';
}

document.getElementById('lightbox').addEventListener('click', function(e) {
  if (e.target === this) closeLightbox();
});

document.addEventListener('keydown', function(e) {
  if (!document.getElementById('lightbox').classList.contains('open')) return;
  if (e.key === 'ArrowLeft') lbNav(-1);
  if (e.key === 'ArrowRight') lbNav(1);
  if (e.key === 'Escape') closeLightbox();
});

// MODAL
function openModal(id) {
  editingId = id || null;
  var p = id ? (properties.find(function(x){return x.id===id;}) || {}) : {};
  document.getElementById('modal-title').textContent = id ? 'Edit Property' : 'Add Property';
  document.getElementById('btn-delete').style.display = id ? 'block' : 'none';
  var flds = {
    'f-address':p.address||'','f-town':p.town||'','f-postcode':p.postcode||'',
    'f-asking-price':p.askingPrice||'','f-price-reduced':p.priceReduced||'No',
    'f-beds-count':p.beds||'','f-baths-count':p.baths||'','f-receptions':p.receptions||'',
    'f-prop-type':p.propType||'Detached','f-tenure':p.tenure||'Freehold','f-new-build':p.newBuild||'No',
    'f-garden-yn':p.garden||'Yes','f-garden-size':p.gardenSize||'',
    'f-out-yn':p.outbuildings||'No','f-out-detail':p.outbuildingDetail||'',
    'f-drive':p.driveway||'Yes','f-garage':p.garage||'No',
    'f-other':p.other||'','f-distance':p.distance||'','f-rural':p.rural||'Village',
    'f-agent':p.agent||'','f-date-listed':p.dateListed||'',
    'f-rm-link':p.rmLink||'','f-zp-link':p.zpLink||'','f-otm-link':p.otmLink||'',
    'f-stat':p.status||'New','f-view-date':p.viewDate||'','f-our-rating':p.rating||'',
    'f-pros':p.pros||'','f-cons':p.cons||'','f-notes':p.notes||''
  };
  Object.keys(flds).forEach(function(id) {
    var el = document.getElementById(id);
    if (el) el.value = flds[id];
  });
  document.getElementById('modal').classList.add('open');
}

function closeModal() {
  document.getElementById('modal').classList.remove('open');
  editingId = null;
}

function saveProperty() {
  var p = {
    id: editingId || Date.now().toString(),
    address: document.getElementById('f-address').value,
    town: document.getElementById('f-town').value,
    postcode: document.getElementById('f-postcode').value,
    askingPrice: parseFloat(document.getElementById('f-asking-price').value)||null,
    priceReduced: document.getElementById('f-price-reduced').value,
    beds: parseInt(document.getElementById('f-beds-count').value)||null,
    baths: parseInt(document.getElementById('f-baths-count').value)||null,
    receptions: parseInt(document.getElementById('f-receptions').value)||null,
    propType: document.getElementById('f-prop-type').value,
    tenure: document.getElementById('f-tenure').value,
    newBuild: document.getElementById('f-new-build').value,
    garden: document.getElementById('f-garden-yn').value,
    gardenSize: document.getElementById('f-garden-size').value,
    outbuildings: document.getElementById('f-out-yn').value,
    outbuildingDetail: document.getElementById('f-out-detail').value,
    driveway: document.getElementById('f-drive').value,
    garage: document.getElementById('f-garage').value,
    other: document.getElementById('f-other').value,
    distance: parseFloat(document.getElementById('f-distance').value)||null,
    rural: document.getElementById('f-rural').value,
    agent: document.getElementById('f-agent').value,
    dateListed: document.getElementById('f-date-listed').value,
    rmLink: document.getElementById('f-rm-link').value,
    zpLink: document.getElementById('f-zp-link').value,
    otmLink: document.getElementById('f-otm-link').value,
    status: document.getElementById('f-stat').value,
    viewDate: document.getElementById('f-view-date').value,
    rating: parseInt(document.getElementById('f-our-rating').value)||null,
    pros: document.getElementById('f-pros').value,
    cons: document.getElementById('f-cons').value,
    notes: document.getElementById('f-notes').value,
    source: 'local'
  };
  if (editingId) {
    var idx = properties.findIndex(function(x){return x.id===editingId;});
    if (idx >= 0) properties[idx] = p;
  } else {
    properties.push(p);
  }
  var localProps = properties.filter(function(x){return x.source==='local'||!x.source;});
  localStorage.setItem('house-search-v1', JSON.stringify(localProps));
  closeModal();
  render();
}

function deleteProperty() {
  if (!editingId || !confirm('Delete this property?')) return;
  properties = properties.filter(function(x){return x.id!==editingId;});
  var localProps = properties.filter(function(x){return x.source==='local'||!x.source;});
  localStorage.setItem('house-search-v1', JSON.stringify(localProps));
  closeModal();
  render();
}

function resetFilters() {
  document.getElementById('f-price').value = 1200000;
  document.getElementById('price-display').textContent = 'Up to ¬£1,200,000';
  document.getElementById('f-radius').value = 8;
  document.getElementById('radius-display').textContent = 'Within 8 miles';
  ['f-beds','f-baths','f-type','f-garden','f-outbuildings','f-school','f-sec-school','f-status','f-sort'].forEach(function(id){
    var el = document.getElementById(id);
    if (el) el.value = id==='f-beds'?'4':id==='f-sort'?'price-desc':'';
  });
  document.getElementById('f-beds').value = '4';
  document.getElementById('f-rating').value = '0';
  document.getElementById('f-sort').value = 'price-desc';
  render();
}

document.getElementById('f-price').addEventListener('input', function() {
  document.getElementById('price-display').textContent = 'Up to ¬£' + Number(this.value).toLocaleString('en-GB');
  render();
});
document.getElementById('f-radius').addEventListener('input', function() {
  document.getElementById('radius-display').textContent = 'Within ' + this.value + ' miles';
  render();
});
['f-beds','f-baths','f-type','f-garden','f-outbuildings','f-school','f-sec-school','f-status','f-rating','f-sort'].forEach(function(id) {
  var el = document.getElementById(id);
  if (el) el.addEventListener('change', render);
});
document.getElementById('modal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    if (document.getElementById('lightbox').classList.contains('open')) closeLightbox();
    else if (document.getElementById('modal').classList.contains('open')) closeModal();
  }
});

// INIT - load remote properties.json then render
(async function() {
  try {
    var resp = await fetch('properties.json?t=' + Date.now());
    if (resp.ok) {
      var remote = await resp.json();
      var local = JSON.parse(localStorage.getItem('house-search-v1') || '[]');
      var localIds = new Set(local.map(function(p){return p.id;}));
      properties = remote.filter(function(p){return !localIds.has(p.id);}).concat(local);
      var dates = remote.map(function(p){return p.lastUpdated;}).filter(Boolean).sort();
      if (dates.length) {
        var el = document.getElementById('remote-updated');
        if (el) el.textContent = 'Updated ' + dates[dates.length-1];
      }
    }
  } catch(e) {
    properties = JSON.parse(localStorage.getItem('house-search-v1') || '[]');
  }
  render();
})();
</script>
</body>
</html>
